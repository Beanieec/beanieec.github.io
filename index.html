<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карточная игра "Козёл"</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }
        
        .team {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            width: 45%;
        }
        
        .team h3 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .score {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .game-table {
            position: relative;
            height: 400px;
            background: rgba(0, 100, 0, 0.7);
            border-radius: 200px;
            margin-bottom: 30px;
            border: 10px solid #8B4513;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .trump-card {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .player {
            position: absolute;
            width: 180px;
            text-align: center;
        }
        
        .player-top {
            top: 20px;
        }
        
        .player-right {
            right: 20px;
            transform: rotate(90deg);
        }
        
        .player-bottom {
            bottom: 20px;
        }
        
        .player-left {
            left: 20px;
            transform: rotate(-90deg);
        }
        
        .player-name {
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .player-cards {
            display: flex;
            justify-content: center;
        }
        
        .card {
            width: 40px;
            height: 60px;
            background: white;
            border-radius: 5px;
            margin: 0 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: black;
            font-weight: bold;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }
        
        .card.red {
            color: red;
        }
        
        .card.back {
            background: linear-gradient(45deg, #ff0000, #ff4500);
            background-size: 10px 10px;
            color: transparent;
        }
        
        .center-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .center-card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            background: #f1c40f;
            border: none;
            border-radius: 5px;
            color: #2c3e50;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            background: #f39c12;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #2c3e50;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        
        .modal h2 {
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .rules-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .rules-content {
            display: none;
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .rules-content h3 {
            margin-bottom: 15px;
        }
        
        .rules-content p {
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Карточная игра "Козёл"</h1>
            <p>Командная игра для четырёх игроков</p>
        </header>
        
        <div class="game-info">
            <div>Кон: <span id="round-number">1</span></div>
            <div>Ход: <span id="current-player">Игрок 1</span></div>
            <div>Козырь: <span id="trump-suit">♠️</span></div>
        </div>
        
        <div class="score-board">
            <div class="team">
                <h3>Команда 1</h3>
                <div class="score" id="team1-score">0</div>
            </div>
            <div class="team">
                <h3>Команда 2</h3>
                <div class="score" id="team2-score">0</div>
            </div>
        </div>
        
        <div class="game-table">
            <div class="trump-card" id="trump-card">♠️</div>
            
            <div class="player player-top">
                <div class="player-name">Игрок 2</div>
                <div class="player-cards">
                    <div class="card back"></div>
                    <div class="card back"></div>
                    <div class="card back"></div>
                </div>
            </div>
            
            <div class="player player-right">
                <div class="player-name">Игрок 3</div>
                <div class="player-cards">
                    <div class="card back"></div>
                    <div class="card back"></div>
                    <div class="card back"></div>
                </div>
            </div>
            
            <div class="player player-bottom">
                <div class="player-name">Вы (Игрок 1)</div>
                <div class="player-cards" id="player-cards">
                    <!-- Карты игрока будут здесь -->
                </div>
            </div>
            
            <div class="player player-left">
                <div class="player-name">Игрок 4</div>
                <div class="player-cards">
                    <div class="card back"></div>
                    <div class="card back"></div>
                    <div class="card back"></div>
                </div>
            </div>
            
            <div class="center-cards" id="center-cards">
                <!-- Карты в центре стола будут здесь -->
            </div>
        </div>
        
        <div class="controls">
            <button id="start-game">Начать игру</button>
            <button id="pants-btn" disabled>Штаны</button>
            <button id="play-card" disabled>Сделать ход</button>
        </div>
    </div>
    
    <div class="modal" id="pants-modal">
        <div class="modal-content">
            <h2>Хвалёнка "Штаны"</h2>
            <p>Вы получили две карты: <span id="pants-cards">7♥ 10♠</span></p>
            <p>Выберите карту для хода:</p>
            <div class="modal-buttons">
                <button id="pants-card1">7♥</button>
                <button id="pants-card2">10♠</button>
            </div>
        </div>
    </div>
    
    <div class="rules-btn" id="rules-btn">?</div>
    <div class="rules-content" id="rules-content">
        <h3>Правила игры "Козёл"</h3>
        <p>Игра для 4 игроков (2 команды по 2 человека).</p>
        <p>Цель: набрать больше очков, чем противники.</p>
        <p>Старшинство карт: Туз (11), 10 (10), Король (4), Дама (3), Валет (2).</p>
        <p>Постоянные козыри: 7 треф ("шамок"), все дамы, все валеты.</p>
        <p>Игроки должны ходить в масть, если нет масти - можно побить козырем или сбросить.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы интерфейса
            const startGameBtn = document.getElementById('start-game');
            const pantsBtn = document.getElementById('pants-btn');
            const playCardBtn = document.getElementById('play-card');
            const playerCardsEl = document.getElementById('player-cards');
            const centerCardsEl = document.getElementById('center-cards');
            const pantsModal = document.getElementById('pants-modal');
            const pantsCard1Btn = document.getElementById('pants-card1');
            const pantsCard2Btn = document.getElementById('pants-card2');
            const pantsCardsEl = document.getElementById('pants-cards');
            const rulesBtn = document.getElementById('rules-btn');
            const rulesContent = document.getElementById('rules-content');
            const currentPlayerEl = document.getElementById('current-player');
            const team1ScoreEl = document.getElementById('team1-score');
            const team2ScoreEl = document.getElementById('team2-score');
            const trumpCardEl = document.getElementById('trump-card');
            const trumpSuitEl = document.getElementById('trump-suit');
            
            // Состояние игры
            let gameState = {
                deck: [],
                players: [[], [], [], []],
                currentPlayer: 0,
                centerCards: [],
                trumpSuit: '',
                scores: [0, 0], // очки команд
                round: 1,
                gameStarted: false,
                pantsMode: false
            };
            
            // Масти карт
            const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
            const suitSymbols = {
                'hearts': '♥',
                'diamonds': '♦',
                'clubs': '♣',
                'spades': '♠'
            };
            
            // Значения карт и их стоимость
            const values = {
                '6': { value: 0, rank: 0 },
                '7': { value: 0, rank: 1 },
                '8': { value: 0, rank: 2 },
                '9': { value: 0, rank: 3 },
                '10': { value: 10, rank: 4 },
                'J': { value: 2, rank: 5 },
                'Q': { value: 3, rank: 6 },
                'K': { value: 4, rank: 7 },
                'A': { value: 11, rank: 8 }
            };
            
            // Инициализация колоды
            function initializeDeck() {
                let deck = [];
                for (let suit of suits) {
                    for (let value in values) {
                        deck.push({
                            value: value,
                            suit: suit,
                            symbol: suitSymbols[suit],
                            points: values[value].value,
                            rank: values[value].rank,
                            isTrump: false
                        });
                    }
                }
                return deck;
            }
            
            // Перемешивание колоды
            function shuffleDeck(deck) {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                return deck;
            }
            
            // Раздача карт
            function dealCards() {
                gameState.deck = shuffleDeck(initializeDeck());
                
                // Определяем козырь (последняя карта в колоде)
                const trumpCard = gameState.deck[gameState.deck.length - 1];
                gameState.trumpSuit = trumpCard.suit;
                
                // Помечаем козыри
                gameState.deck.forEach(card => {
                    if (card.suit === gameState.trumpSuit || 
                        card.value === 'J' || 
                        card.value === 'Q' ||
                        (card.value === '7' && card.suit === 'clubs')) {
                        card.isTrump = true;
                    }
                });
                
                // Раздаем по 8 карт каждому игроку
                for (let i = 0; i < 4; i++) {
                    gameState.players[i] = gameState.deck.splice(0, 8);
                }
                
                // Сортируем карты игрока
                sortPlayerCards();
                
                updateTrumpDisplay();
            }
            
            // Сортировка карт игрока
            function sortPlayerCards() {
                gameState.players[0].sort((a, b) => {
                    // Сначала по масти
                    if (a.suit !== b.suit) {
                        return suits.indexOf(a.suit) - suits.indexOf(b.suit);
                    }
                    // Затем по рангу
                    return a.rank - b.rank;
                });
            }
            
            // Обновление отображения козыря
            function updateTrumpDisplay() {
                trumpCardEl.textContent = suitSymbols[gameState.trumpSuit];
                trumpSuitEl.textContent = suitSymbols[gameState.trumpSuit];
            }
            
            // Отображение карт игрока
            function renderPlayerCards() {
                playerCardsEl.innerHTML = '';
                gameState.players[0].forEach((card, index) => {
                    const cardEl = document.createElement('div');
                    cardEl.className = `card ${card.suit === 'hearts' || card.suit === 'diamonds' ? 'red' : ''}`;
                    cardEl.textContent = `${card.value}${card.symbol}`;
                    cardEl.dataset.index = index;
                    cardEl.addEventListener('click', () => selectCard(index));
                    playerCardsEl.appendChild(cardEl);
                });
            }
            
            // Выбор карты для хода
            function selectCard(index) {
                // Снимаем выделение со всех карт
                document.querySelectorAll('.card').forEach(card => {
                    card.style.border = '';
                });
                
                // Выделяем выбранную карту
                document.querySelector(`.card[data-index="${index}"]`).style.border = '2px solid yellow';
                
                // Активируем кнопку хода
                playCardBtn.disabled = false;
            }
            
            // Ход игрока
            function playCard(cardIndex) {
                if (cardIndex === undefined) return;
                
                const card = gameState.players[0][cardIndex];
                gameState.centerCards.push({
                    card: card,
                    player: 0
                });
                
                // Удаляем карту из руки игрока
                gameState.players[0].splice(cardIndex, 1);
                
                // Обновляем отображение
                renderPlayerCards();
                renderCenterCards();
                
                // Передаем ход следующему игроку
                gameState.currentPlayer = 1;
                currentPlayerEl.textContent = `Игрок ${gameState.currentPlayer + 1}`;
                
                // Деактивируем кнопку хода
                playCardBtn.disabled = true;
                
                // ИИ делает ход
                setTimeout(() => aiMove(), 1000);
            }
            
            // Ход компьютерных игроков
            function aiMove() {
                if (gameState.currentPlayer === 0) return;
                
                const playerIndex = gameState.currentPlayer;
                const playerCards = gameState.players[playerIndex];
                
                // Простая логика ИИ: первая доступная карта
                let cardToPlay = playerCards[0];
                
                gameState.centerCards.push({
                    card: cardToPlay,
                    player: playerIndex
                });
                
                // Удаляем карту из руки ИИ
                gameState.players[playerIndex].splice(0, 1);
                
                // Обновляем отображение
                renderCenterCards();
                
                // Передаем ход следующему игроку
                gameState.currentPlayer = (playerIndex + 1) % 4;
                currentPlayerEl.textContent = `Игрок ${gameState.currentPlayer + 1}`;
                
                // Если все сделали ход, определяем победителя взятки
                if (gameState.centerCards.length === 4) {
                    setTimeout(() => resolveTrick(), 1000);
                } else if (gameState.currentPlayer !== 0) {
                    // Следующий ИИ ходит
                    setTimeout(() => aiMove(), 1000);
                } else {
                    // Ход снова у игрока
                    playCardBtn.disabled = false;
                }
            }
            
            // Определение победителя взятки
            function resolveTrick() {
                // Простая логика: первая карта определяет масть
                const leadSuit = gameState.centerCards[0].card.suit;
                let winningCard = gameState.centerCards[0];
                let winningPlayer = 0;
                
                for (let i = 1; i < gameState.centerCards.length; i++) {
                    const currentCard = gameState.centerCards[i];
                    
                    // Если это козырь, а текущий выигрывающий - нет
                    if (currentCard.card.isTrump && !winningCard.card.isTrump) {
                        winningCard = currentCard;
                        winningPlayer = i;
                    }
                    // Если оба козыря, сравниваем по рангу
                    else if (currentCard.card.isTrump && winningCard.card.isTrump) {
                        if (currentCard.card.rank > winningCard.card.rank) {
                            winningCard = currentCard;
                            winningPlayer = i;
                        }
                    }
                    // Если не козырь, но масть совпадает с ходом
                    else if (currentCard.card.suit === leadSuit && !winningCard.card.isTrump) {
                        if (currentCard.card.rank > winningCard.card.rank) {
                            winningCard = currentCard;
                            winningPlayer = i;
                        }
                    }
                }
                
                // Добавляем очки команде-победителю
                let points = 0;
                gameState.centerCards.forEach(trick => {
                    points += trick.card.points;
                });
                
                // Определяем команду победителя (0 и 2 - команда 1, 1 и 3 - команда 2)
                const winningTeam = winningPlayer % 2 === 0 ? 0 : 1;
                gameState.scores[winningTeam] += points;
                
                // Обновляем счет
                team1ScoreEl.textContent = gameState.scores[0];
                team2ScoreEl.textContent = gameState.scores[1];
                
                // Очищаем центр стола
                gameState.centerCards = [];
                renderCenterCards();
                
                // Передаем ход победителю взятки
                gameState.currentPlayer = winningPlayer;
                currentPlayerEl.textContent = `Игрок ${gameState.currentPlayer + 1}`;
                
                // Проверяем конец раунда
                if (gameState.players[0].length === 0 && 
                    gameState.players[1].length === 0 &&
                    gameState.players[2].length === 0 &&
                    gameState.players[3].length === 0) {
                    endRound();
                } else if (gameState.currentPlayer === 0) {
                    // Ход снова у игрока
                    playCardBtn.disabled = false;
                } else {
                    // ИИ делает ход
                    setTimeout(() => aiMove(), 1000);
                }
            }
            
            // Конец раунда
            function endRound() {
                alert(`Раунд окончен! Счет: Команда 1 - ${gameState.scores[0]}, Команда 2 - ${gameState.scores[1]}`);
                
                // Увеличиваем номер раунда
                gameState.round++;
                document.getElementById('round-number').textContent = gameState.round;
                
                // Начинаем новый раунд
                startGame();
            }
            
            // Отображение карт в центре стола
            function renderCenterCards() {
                centerCardsEl.innerHTML = '';
                gameState.centerCards.forEach(trick => {
                    const cardEl = document.createElement('div');
                    cardEl.className = `center-card ${trick.card.suit === 'hearts' || trick.card.suit === 'diamonds' ? 'red' : ''}`;
                    cardEl.textContent = `${trick.card.value}${trick.card.symbol}`;
                    centerCardsEl.appendChild(cardEl);
                });
            }
            
            // Режим "Штаны"
            function startPantsMode() {
                gameState.pantsMode = true;
                
                // Берем две карты из колоды
                const card1 = gameState.deck.shift();
                const card2 = gameState.deck.pop();
                
                // Показываем модальное окно с выбором карты
                pantsCardsEl.textContent = `${card1.value}${card1.symbol} ${card2.value}${card2.symbol}`;
                pantsCard1Btn.textContent = `${card1.value}${card1.symbol}`;
                pantsCard2Btn.textContent = `${card2.value}${card2.symbol}`;
                
                pantsModal.style.display = 'flex';
                
                // Обработчики выбора карты
                pantsCard1Btn.onclick = () => {
                    pantsModal.style.display = 'none';
                    // Добавляем выбранную карту в руку игрока
                    gameState.players[0].push(card1);
                    // Вторую карту добавляем в колоду
                    gameState.deck.push(card2);
                    sortPlayerCards();
                    renderPlayerCards();
                    gameState.pantsMode = false;
                };
                
                pantsCard2Btn.onclick = () => {
                    pantsModal.style.display = 'none';
                    // Добавляем выбранную карту в руку игрока
                    gameState.players[0].push(card2);
                    // Вторую карту добавляем в колоду
                    gameState.deck.push(card1);
                    sortPlayerCards();
                    renderPlayerCards();
                    gameState.pantsMode = false;
                };
            }
            
            // Начало игры
            function startGame() {
                gameState.gameStarted = true;
                dealCards();
                renderPlayerCards();
                
                // Активируем кнопки
                pantsBtn.disabled = false;
                
                // Определяем первого игрока
                gameState.currentPlayer = 0;
                currentPlayerEl.textContent = `Игрок ${gameState.currentPlayer + 1}`;
                
                // Сбрасываем счет
                gameState.scores = [0, 0];
                team1ScoreEl.textContent = '0';
                team2ScoreEl.textContent = '0';
            }
            
            // Обработчики событий
            startGameBtn.addEventListener('click', startGame);
            
            pantsBtn.addEventListener('click', startPantsMode);
            
            playCardBtn.addEventListener('click', function() {
                const selectedCard = document.querySelector('.card[style*="border: 2px solid yellow"]');
                if (selectedCard) {
                    const cardIndex = parseInt(selectedCard.dataset.index);
                    playCard(cardIndex);
                }
            });
            
            rulesBtn.addEventListener('click', function() {
                rulesContent.style.display = rulesContent.style.display === 'block' ? 'none' : 'block';
            });
            
            // Закрываем правила при клике вне их области
            document.addEventListener('click', function(event) {
                if (!rulesBtn.contains(event.target) && !rulesContent.contains(event.target)) {
                    rulesContent.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
